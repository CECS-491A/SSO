<template>
    <div class="register-wrapper">
        
        <h1 class="header">Register your Application</h1>

        <br />
        <v-form>
        <v-text-field
            name="title"
            id="title"
            v-model="title"
            type="title"
            label="Title" 
            v-if="!key"
            /><br />
        <v-text-field
            name="launchUrl"
            id="launchUrl"
            type="launchUrl"
            v-model="launchUrl"
            label="Launch Url" 
            v-if="!key"
            /><br />
        <v-text-field
            name="email"
            id="email"
            type="email"
            v-model="email"
            label="Email" 
            v-if="!key"
            /><br />
        <v-text-field
            name="deleteUrl"
            id="deleteUrl"
            type="deleteUrl"
            v-model="deleteUrl"
            label="User Deletion Url" 
            v-if="!key"
            /><br />

        
        <v-alert
            :value="error"
            id="error"
            type="error"
            transition="scale-transition"
        >
            {{error}}
        </v-alert>

        <div id="responseMessage" v-if="message">
            <h3>{{ message }}</h3>
            <br />
        </div>
        <div id="applicationId" v-if="appId">
            <h3>Your Application ID</h3>
            <p>{{ appId }}</p>
        </div>
        <div id="apiKeyMessage" v-if="key">
            <h3>Your API Key:</h3>
            <p>{{ key }}</p>
        </div>
        <div id="secretKeyMessage" v-if="secretKey">
            <h3>Your Secret Key</h3>
            <p>{{ secretKey }}</p>
        </div>

        <br />

        <v-btn id="btnRegister" color="success" v-if="!key" v-on:click="register">Register</v-btn>

        </v-form>
        
    </div>
</template>

<script>
import axios from 'axios'
import { apiURL } from '@/const.js'

export default {
  data () {
    return {
      message: null,
      key: null,
      secretKey: null,
      appId: null,
      title: '',
      email: '',
      launchUrl: '',
      deleteUrl: '',
      error: ''
    }
  },
  methods: {
    register: function () {
      
      this.error = "";
      if (this.title.length == 0 || this.email.length == 0 || this.launchUrl.length == 0 || this.deleteUrl.length == 0) {
        this.error = "Fields Cannot Be Left Blank.";
      }

      if (this.error) return;

      const url = `${apiURL}/applications/create`
      axios.post(url, {
        title: document.getElementById('title').value,
        launchUrl: document.getElementById('launchUrl').value,
        email: document.getElementById('email').value,
        deleteUrl: document.getElementById('deleteUrl').value,
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        }
      })
        .then(response => {
            this.message = response.data.Message;
            this.key = response.data.Key; // Retrieve api key from response
            this.secretKey = response.data.SharedSecretKey // Retrieve shared api key from response
            this.appId = response.data.AppId // Retrieve application id from response
        })
        .catch(err => {
            this.error = err.response.data.Message;
        })
    }
  }
}

</script>

<style lang="css">

.register-wrapper {
    width: 70%;
    margin: 1px auto;
}

</style>
